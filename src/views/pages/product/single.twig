{#
| Variable                               | Type                        | Description                                                            |
|----------------------------------------|-----------------------------|------------------------------------------------------------------------|
| page                                   | object                      |                                                                        |
| page.title                             | string                      | *could be html                                                         |
| page.slug                              | string                      | ex: "cat.show"                                                         |
| product                                | Product                     |                                                                        |
| product.id                             | int                         |                                                                        |
| product.name                           | string                      |                                                                        |
| product.description                    | string                      | HTML                                                                   |
| product.url                            | string                      |                                                                        |
| product.promotion_title                | string                      |                                                                        |
| product.subtitle                       | string                      |                                                                        |
| product.type                           | string                      | product, service, group_products, codes, digital, food, donating       |
| product.status                         | string                      | sale, out, out-and-notify                                              |
| product.weight                         | ?string                     |                                                                        |
| product.calories                       | ?float                      |                                                                        |
| product.sku                            | ?string                     |                                                                        |
| product.rating                         | ?Rating                     |                                                                        |
| product.rating.count                   | int                         |                                                                        |
| product.rating.stars                   | int                         |                                                                        |
| product.price                          | float                       | can be string too `-`, when merchant doesn't want to show zero         |
| product.sale_price                     | float                       |                                                                        |
| product.regular_price                  | float                       |                                                                        |
| product.starting_price                 | ?float                      |                                                                        |
| product.quantity                       | ?int                        | if it's null, means it's unlimited                                     |
| product.sold_quantity                  | int                         |                                                                        |
| product.max_quantity                   | int                         |                                                                        |
| product.discount_ends                  | ?date                       |                                                                        |
| product.is_taxable                     | bool                        | Is the tax included in the price                                       |
| product.category                       | ?Category                   |                                                                        |
| product.category.name                  | string                      |                                                                        |
| product.category.url                   | string                      |                                                                        |
| product.image                          | object                      |                                                                        |
| product.image.url                      | string                      |                                                                        |
| product.image.alt                      | ?string                     |                                                                        |
| product.images                         | array                       |                                                                        |
| product.images[].id                    | int                         |                                                                        |
| product.images[].url                   | string                      |                                                                        |
| product.images[].alt                   | ?string                     |                                                                        |
| product.images[].video_url             | ?string                     |                                                                        |
| product.images[].type                  | string                      | `image` `video`                                                        |
| product.brand                          | ?object                     |                                                                        |
| product.brand.id                       | int                         |                                                                        |
| product.brand.url                      | ?string                     |                                                                        |
| product.brand.name                     | ?string                     |                                                                        |
| product.brand.logo                     | ?string                     |                                                                        |
| product.tags                           | ?Tags[] *Collection         |                                                                        |
| product.tags[].name                    | string                      |                                                                        |
| product.tags[].url                     | string                      |                                                                        |
| product.options                        | ProductOption[] *Collection | @see views/pages/partials/product/options.twig                         |
| product.notify_availability            | ?object                     | does product outOfStock & can visitor subscribe to notify availability |
| product.notify_availability.channels   | array                       | ex: ['sms', 'email']                                                   |
| product.notify_availability.subscribed | bool                        | Does user subscribed before                                            |
| product.donation                       | ?ProductDonation            |                                                                        |
| product.donation.target_message        | ?string                     | Message if reached to target or target expired                         |
| product.donation.collected_amount      | float                       |                                                                        |
| product.donation.target_amount         | float                       |                                                                        |
| product.donation.target_percent        | float                       |                                                                        |
| product.donation.target_end_date       | ?Date                       |                                                                        |
| product.donation.can_donate            | bool                        | `true` When there is no campaign or (target not reached & not expired) |
| product.has_read_more                  | bool                        |                                                                        |
| product.can_add_note                   | bool                        |                                                                        |
| product.can_show_remained_quantity     | bool                        |                                                                        |
| product.can_show_sold                  | bool                        |                                                                        |
| product.can_upload_file                | bool                        |                                                                        |
| product.has_custom_form                | bool                        | Is it for  `Food` or `Custom Service` product                          |
| product.has_metadata                   | bool                        |                                                                        |
| product.has_options                    | bool                        |                                                                        |
| product.is_on_sale                     | bool                        | Product has discounted price                                           |
| product.is_hidden_quantity             | bool                        | The quantity is hidden by merchant, or product not available           |
| product.is_available                   | bool                        |                                                                        |
| product.is_in_wishlist                 | bool                        |                                                                        |
| product.is_out_of_stock                | bool                        |                                                                        |
| product.is_require_shipping            | bool                        |                                                                        |
| product.base_currency_price            | float                       | product.price with base currency (SAR)                                 |
| product.discount_percentage            | ?string                     | ex: "20%"                                                              |
| product.has_3d_image                   | bool                        |                                                                        |
| product.has_size_guide                 | bool                        |                                                                        |
| product.is_giftable                    | bool                        |                                                                        |
| product.add_to_cart_label              | string                      |                                                                        |
| product.currency                       | string                      |                                                                        |
#}
{% extends "layouts.master" %}
{% block content %}
{% set delivery_details = theme.settings.get('delivery_details') %}
{% set delivery_details_title = theme.settings.get('delivery_details_title') %}

    <div class="container">

        {# add breadcumbs container in pages to make a space in case breadcrumbs is off #}
        <nav class="breadcrumbs w-full pb-4 pt-5 flex justify-between items-center">
            <salla-breadcrumb class="scale-75 rtl:pr-2 ltr:pl-2 !font-light"></salla-breadcrumb>

            <div catId="{{ product.category.id }}" productId="{{product.id}}" class="go-to-product-by-arrows flex items-center gap-3 text-xl relative">
                {% for n in 0..1 %}
                    <div class="{{loop.index == 1 ? 'prev' : 'next'}}-product group">
                        {% if user.language.dir == 'ltr'%}
                            <a href="#" data-target="product-{{product.id}}-{{loop.index}}" data-event-in="mouseover" data-event-leave="mouseout" class="general-effect text-xs">
                                {% if loop.index == 1 %}
                                <i class="sicon-caret-{{loop.index == 1 ? 'left' : 'right'}}"></i>
                                {{ trans('blocks.product.Previous') }}
                                {% else %}
                                {{ trans('blocks.product.Next') }}
                                <i class="sicon-caret-{{loop.index == 1 ? 'left' : 'right'}}"></i>
                                {% endif %}
                            </a>
                        {% else %}
                            <a href="#" data-target="product-{{product.id}}-{{loop.index}}" data-event-in="mouseover" data-event-leave="mouseout" class="general-effect text-xs">
                                {% if loop.index == 1 %}
                                <i class="sicon-caret-{{loop.index == 1 ? 'right' : 'left'}}"></i>
                                {{ trans('blocks.product.Previous') }}
                                {% else %}
                                {{ trans('blocks.product.Next') }}
                                <i class="sicon-caret-{{loop.index == 1 ? 'right' : 'left'}}"></i>
                                {% endif %}
                            </a>
                        {% endif %}
                        <a href="#" id="product-{{product.id}}-{{loop.index}}" class="absolute w-60 flex items-center justify-between transition-all duration-300 opacity-0 translate-y-3 gap-2.5 border border-gray-100 shadow-[0_0_10px_#726e6e17] ltr:right-2 rtl:left-2 bg-white rounded-[8px] p-1 z-10">
                            <div class="w-36 h-20 rounded-md overflow-hidden">
                                <img class="product-image w-full h-full object-cover object-top" src="{{product.image.url}}" />
                            </div>
                            <div class="flex flex-col gap-.5 w-full">
                                <span class="product-name text-xxs font-normal line-clamp-2 leading-[normal]">{{product.name}}</span>
                                <span class="product-price text-sm uppercase font-normal">{{product.price|money}}</span>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            <div>
        </nav>
        <div class="flex flex-col items-start md:flex-row md:justify-center md:gap-11" id="product-{{ product.id }}">
            <div class="sidebar w-full md:!w-[40%] pb-8 md:pb-16 overflow-hidden shrink-0">
                {% set has_many_images = product.images|length > 1 %}
                <salla-slider id="details-slider-{{ product.id }}" class="details-slider rounded-md image-slider [&_.swiper-slide-thumb-active]:border-dark " type="thumbs" loop="false" auto-height listen-to-thumbnails-option show-thumbs-controls="false">
                    {% if product.promotion_title %}
                        <div class="promotion-title">{{ product.promotion_title }}</div>
                    {% endif %}

                    {# <salla-button class="btn--wishlist animated sws" data-id="{{ product.id }}" onclick="salla.wishlist.toggle({{ product.id }})" shape="icon" fill="outline" color="light"> <i class="sicon-heart"></i>
                    </salla-button> #}

                    {# Calories Badge #}
                    {% if product.calories %}
                        <div class="absolute z-[2] top-4 rtl:left-4 ltr:right-4 bg-white shadow-sm flex flex-col justify-center items-center rounded-full w-20 h-20 md:w-24 md:h-24">
                            <span class="text-red-500 text-xl leading-none font-bold">{{ product.calories }}</span>
                            <span class="text-xs text-gray-500">{{ trans('pages.products.calories') }}</span>
                        </div>
                    {% endif %}

                    <div slot="items">
                        {% for image in product.images %}
                            {% if image.three_d_image_url %}
                                <model-viewer style="min-height: 500px;" class="swiper-slide model-entry w-full h-full" loading="eager" camera-controls touch-action="pan-y" auto-rotate poster="{{ image.url }}" src="{{ image.three_d_image_url }}" shadow-intensity="1" alt="{{ image.alt }}">
                                </model-viewer>
                            {% else %}
                            <div class="swiper-slide">
                                <a data-fslightbox="product_{{ product.id }}" data-img-id="{{ image.id }}" data-slid-index="{{ loop.index-1 }}"{% if image.video_url %} data-video-src="{{ image.video_url }}"{% endif %} data-caption="{{ image.alt }}" data-infinite="false" data-type="{{ image.video_url?'youtube':'image' }}" href="{{ (image.video_url is iterable ? image.video_url|first : image.video_url)|default(image.url) }}" aria-label="{{ product.name }}" class="swiper-slide magnify-wrapper homeslider__slide {{ image.video_url?'video-entry':'' }}">
                                    {% if loop.first %}
                                        <img id="{{image.id}}" fetchpriority="high" loading="eager" src="{{ image.url }}" alt="{{ image.alt }}" class="h-full object-{{ theme.settings.get('slider_background_size') }} w-full {{ image.three_d_image_url ? 'model-poster' : '' }}">
                                    {% else %}
                                        <img id="{{image.id}}" src="{{ 'images/s-empty.png' | cdn }}" data-src="{{ image.url }}" alt="{{ image.alt }}" class="lazy h-full object-{{ theme.settings.get('slider_background_size') }} w-full {{ image.three_d_image_url ? 'model-poster' : '' }}">
                                    {% endif %}
                                </a>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>

                    {% if has_many_images %}
                        <div slot="thumbs">
                            {% for image in product.images %}
                                <div class="!w-14 !h-auto !mx-0.5 !rounded-none after:!hidden border-b-[3px] border-transparent {{ image.video_url?'video-entry':'' }} {{ image.three_d_image_url?'model-entry':'' }} {% if image.video_url %} data-video-src {% endif %}">
                                    {% if loop.index < 5 %}
                                        <img src="{{ image.url }}" loading="eager" class="object-cover w-full h-full bg-gray-100 overflow-hidden" title="{{ image.alt }}" alt="{{ image.alt }}"/>
                                    {% else %}
                                        <img data-src="{{ image.url }}" src="{{ 'images/s-empty.png' | cdn }}" class="object-cover w-full h-full lazy bg-gray-100 overflow-hidden" title="{{ image.alt }}" alt="{{ image.alt }}"/>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </salla-slider>
            </div>

            <div class="main-content md:sticky md:overflow-hidden top-24 w-full md:w-[60%] md:max-w-[490px] md:pb-16">

                {% hook 'product:single.description.start' %}

                {% if product.brand.name %}
                    <div class="product-brand mb-5 w-12">
                        <a class="brand-logo" href="{{ product.brand.url }}" title="{{ product.brand.name }}">
                            <img width="100%" height="100%" class="max-h-full object-contain" src="{{ product.brand.logo }}" title="{{ product.brand.name }}" alt="{{ product.brand.name }}">
                        </a>
                    </div>
                {% endif %}
                    <div class="flex justify-between items-start gap-3 mb-6">
                        <div class="flex flex-col gap-2">
                            <h1 class="text-xl leading-[normal] text-dark font-normal max-w-xs">{{ product.name }}</h1>
                            {% if product.subtitle and theme.settings.get('show_product_subtitle') %}
                                <h2 class="product-entry__sub-title text-sm text-gray-500 leading-6 mb-2.5">
                                    {{ product.subtitle }}
                                </h2>
                            {% endif %}
                        </div>
                        <div class="flex whitespace-nowrap price-wrapper gap-4 items-center rtl:ml-5 ltr:mr-5">
                            <div class="{{ product.is_on_sale ? '' : 'hidden' }} price_is_on_sale space-x-2 rtl:space-x-reverse whitespace-nowrap">
                            <h2 class="total-price text-red-800 font-bold text-base inline-block">{{product.sale_price|money}}</h2>
                            <span class="before-price text-gray-500 line-through">{{product.regular_price|money}}</span>
                            </div>
                            <div class="starting-or-normal-price gap-4 {{ product.is_on_sale ? 'hidden' : 'flex' }}">
                            {% if product.starting_price %}
                                <span class="starting-price-title">{{ trans('pages.products.starting_price') }}</span>
                            {% endif %}
                            <h2 class="total-price font-bold text-base inline-block"> {{product.starting_price ? product.starting_price|money : product.price|money }}</h2>
                        </div>
                    </div>
                </div>
                {% if product.sold_quantity or product.can_show_remained_quantity %}
                <div class="bg-white py-2.5 mb-5 rounded-md inline-flex text-sm">
                    {% if product.sold_quantity %}
                        <div class="px-4 !text-red-800">
                            <i class="sicon-fire rtl:ml-1.5 ltr:mr-1.5"></i> {{ trans('pages.products.sold') }}
                            <span>{{ pluralize('pages.products.sold_times', product.sold_quantity)|raw }}</span>
                        </div>
                    {% endif %}
                    {% if product.can_show_remained_quantity %}
                        <div class="px-4 rtl:even:border-r ltr:even:border-l even:border-gray-200">
                            <i class="!text-red-800 sicon-box-bankers rtl:ml-1.5 ltr:mr-1.5"></i>
                            {{ trans('pages.products.remained') }}
                            <span>{{ product.quantity }}</span>
                        </div>
                    {% endif %}
                </div>
                {% endif %}
                <hr class="my-5">
                    {% set return_sar = theme.settings.get('return_sar') %}
                    {% set return_theworld = theme.settings.get('return_theworld') %}
                    <div class="{{ delivery_details or return_theworld or return_sar ? 'p-3 bg-[#ededed] flex flex-col items-center gap-3 mb-3 rounded' :'' }}">
                        {% include 'components.general.return_sar' with {is_select_branches:true} %}
                        {% if delivery_details %}
                        <div class="flex items-center gap-3 rounded bg-white p-3 w-full">
                            <svg width="35" height="35" viewBox="0 0 22 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g filter="url(#filter0_d_356_351)">
                            <path d="M5.65337 8.875C6.41685 11.2704 8.60348 13 11.1818 13C14.3951 13 17 10.3137 17 7C17 3.68629 14.3951 1 11.1818 1C9.02827 1 7.148 2.2066 6.14201 4M7.90909 4.75H5V1.75" stroke="black" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
                            </g>
                        </svg>
                        <span class="text-sm">{{delivery_details_title}}</span>
                        </div>
                        {% endif %}
                    </div>

                {% set promotional_advertisement = theme.settings.get('promotional_advertisement') %}
                {% set title_advertisement = theme.settings.get('title_advertisement') %}
                {% if promotional_advertisement %}
                <hr class="my-5">
                <div class="flex items-center gap-4 rounded-3xl p-4 py-5 w-full text-sm my-5"
                style="background-color: {{ theme.settings.get('promotional_advertisement_bg_color')|default('#f8e8e5') }};"
                >
                    {% if theme.settings.get('promotional_advertisement_custom_icon') %}
                        {{ theme.settings.get('promotional_advertisement_icon_code') }}
                    {% else %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"></path>
                        </svg>
                    {% endif %}
                    <span style="color: {{ theme.settings.get('promotional_advertisement_text_color')|default('#000000') }};">{{title_advertisement}}</span>
                </div>
                {% endif %}

                {% if product.rating %}
                    <salla-rating-stars value="{{ product.rating.stars }}" reviews="{{ product.rating.count }}"></salla-rating-stars>
                {% endif %}

                {% if product.is_taxable %}
                    <small class="color-grey">{{ trans('pages.products.tax_included') }}</small>
                {% endif %}

                {% if product.tags|length and theme.settings.get('show_tags', true) %}
                    <div class="mb-3">
                        {% for tag in product.tags %}
                        <a href="{{ tag.url }}" class="rtl:ml-2 ltr:mr-2 inline-flex text-gray-500 hover:text-primary underline text-sm mb-1">{{ tag.name }}</a>
                        {% endfor %}
                    </div>
                {% endif %}

                {# <div class="flex rtl:space-x-reverse space-x-3">
                    <salla-social-share class="inline-flex mb-5" aria-label="social share"></salla-social-share>
                    <salla-button class="btn--wishlist animated hidden sm:inline-flex" data-id="{{ product.id }}" onclick="salla.wishlist.toggle({{ product.id }})" shape="icon" fill="outline" color="light" aria-label="add to wishlist">
                        <i class="sicon-heart"></i>
                    </salla-button>
                </div> #}


                {% if product.sku and theme.settings.get('show_product_sku') %}
                    <div class="mb-4 flex justify-between x-4 py-2">
                        <div class="flex items-center">
                            <i class="sicon-barcode mx-1"></i>
                            {{ trans('pages.products.sku') }}
                        </div>
                        <div class="text-unicode">{{ product.sku }}</div>
                    </div>
                {% endif %}
                {% hook 'product:single.description' %}

                {% if product.show_availability %}
                    <section class="bg-white rounded-md mb-5 last:mb-0">
                        <div class="center-between">
                            <label class="flex items-center text-base">
                                <span class="sicon-location rtl:ml-1 ltr:mr-1"></span>
                                <span class="inline-block">{{ trans('pages.products.availability') }}</span>
                            </label>
                            <div class="mt-1 sm:mt-0 sm:col-span-2 text-end">
                                <div class="flex rtl:space-x-reverse space-x-3">
                                    <a href="#!" onclick="salla.event.dispatch('scopes::open', {mode: 'availability', product_id: {{ product.id }} })" class="group text-primary flex items-center justify-center">
                                        <span>{{ trans('pages.products.select_branch') }}</span>
                                        <span class="sicon-keyboard_arrow_left mr-2 transition-all group-hover:-translate-x-1"></span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </section>
                {% endif %}

                <form class="form product-form w-full" id="single-product-form" enctype="multipart/form-data" method="post" onsubmit="return salla.form.onSubmit('cart.addItem', event)" >
                    <input type="hidden" name="id" value="{{ product.id }}">
                    {% hook 'product:single.form.start' %}
                    {% include 'pages.partials.product.options' %}

                    {% hook 'product:single.form.end' %}
                    <section class="sticky-product-bar pb-5">
                        {# Quantity #}
                        {% if product.is_hidden_quantity or product.type == 'booking' %}
                            <input type="hidden" value="1" name="quantity" aria-label="Quantity"/>
                        {% else %}
                            <div class="sticky-product-bar__quantity mb-5 flex gap-3 flex-col">
                                <label class="form-label font-bold">
                                {{ trans('pages.products.quantity') }}
                                <div class="out-of-stock min-h-7 leading-7 hidden text-base text-red-600 !opacity-50 font-bold">{{ trans('pages.products.out_of_stock')}}</div>
                                </label>
                                <salla-quantity-input max="{{ product.max_quantity }}" value="1" name="quantity" aria-label="Quantity" class="flex [&_.s-quantity-input-container]:h-12 [&_.s-quantity-input-container]:gap-2.5 [&_.s-quantity-input-container]:border-none [&_button]:border [&_button]:w-12 [&_button]:rounded-[3px] [&_input]:border [&_input]:w-12 [&_input]:rounded-[3px]"></salla-quantity-input>
                            </div>
                        {% endif %}
                        {# Add to cart #}
                        <salla-add-product-button quick-buy {{theme.settings.get('sticky_add_to_cart') ? ' support-sticky-bar' : ''}} {{product.is_require_shipping ? 'required-shipping' : ''}} amount="{{ product.base_currency_price }}" class="mt-5 !w-full sticky-product-bar__btn add-product-page !flex-col [&_.s-add-product-button-main]:!flex-col [&_.s-add-product-button-main]:gap-4 [&_salla-button]:!w-full [&_button]:!w-full [&_button]:py-3 [&_button]:rounded-2xl [&_salla-mini-checkout-widget]:!w-full" product-status="{{ product.status }}" product-type="{{ product.type }}" product-id="{{ product.id }}" loader-position="end" type="submit" width="normal" fill="solid"
                                {# Notify availability props#}
                                {% if product.notify_availability %}
                                    {{ product.notify_availability.subscribed ? 'is-subscribed' : '' }}
                                    channels="{{ product.notify_availability.channels|join(',') }}"
                                    subscribed-options="{{ product.notify_availability.subscribed_options|json_encode }}"
                                    {{ product.notify_availability.options ? 'notify-options-availability' : '' }}
                                {% endif %}>
                            {{ product.add_to_cart_label }}
                        </salla-add-product-button>
                    </section>
                    {% if product.is_giftable %}
                        <salla-gifting class="mt-5" widget-subtitle="{{ gifting_intro }}" product-id="{{ product.id }}"></salla-gifting>
                    {% endif %}
                </form>
                {% set product_desc = product.description|replace({"&nbsp;":"\n"}) %}
                <div class="border-y border-darker">
                    <div class="accordion cursor-pointer group active">
                        <span class="accordion-title flex justify-start items-center gap-4 py-3">
                            <i class="sicon-minus icone"></i>
                            {{ trans('blocks.product.readMore') }}
                        </span>
                    </div>
                    <div class="panel overflow-hidden transition-all duration-700 mb-1 is-opened">
                        <article class="article--main pb-1">{{ product_desc|raw }}</article>
                    </div>
                </div>
                <div id="metadata-name"></div>
                {% include 'components.general.return_sar'%}
                {% hook 'product:single.description.end' %}
                <salla-installment price="{{ product.price }}"></salla-installment>
                <salla-quick-order class="mt-5 md:-mb-2 block"></salla-quick-order>
            </div>
        </div>
        <salla-offer></salla-offer>
    </div>

    {# Comments Area #}
    <salla-comments item-id="{{product.id}}" type="product"></salla-comments>
    {# Similar Products Area #}

    <salla-products-slider source="related" source-value="{{product.id}}" block-title="{{trans('pages.products.similar_products')}}" class="aleena-arrows aleena-arrows-5" limit="5" includes='{{theme.settings.get('includes_features')|json_encode}}' display-all-url></salla-products-slider>
<style>
    .add-product-page salla-button ,.add-product-page button{
        width:100% !important ;
    }
    .s-add-product-button-main:not(.w-full) > salla-button {
        width: 100% !important;
    }
    .s-product-options-grid-mode input:checked + div {
        background-color: #000;
        color: #fff;
        border-color: var(--color-primary);
    }

</style>
{% endblock %}

{% block scripts %}
    <script defer src="{{ 'product.js' | asset }}"></script>
    {% if product.has_3d_image %}
        <script type="module" defer src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    {% endif %}
{% endblock %}

